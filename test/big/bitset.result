lua dofile('utils.lua')
---
...
lua dofile('bitset.lua')
---
...
lua fill(1, 128)
---
...
lua test(box.index.BITS_ALL)
---
sorted output
$       1$
$       2$
$       3$
$       4$
$       5$
$       6$
$       7$
$       8$
$       9$
$      10$
$      11$
$      12$
$      13$
$      14$
$      15$
$      16$
$      17$
$      18$
$      19$
$      20$
$      21$
$      22$
$      23$
$      24$
$      25$
$      26$
$      27$
$      28$
$      29$
$      30$
$      31$
$      32$
$      33$
$      34$
$      35$
$      36$
$      37$
$      38$
$      39$
$      40$
$      41$
$      42$
$      43$
$      44$
$      45$
$      46$
$      47$
$      48$
$      49$
$      50$
$      51$
$      52$
$      53$
$      54$
$      55$
$      56$
$      57$
$      58$
$      59$
$      60$
$      61$
$      62$
$      63$
$      64$
$      65$
$      66$
$      67$
$      68$
$      69$
$      70$
$      71$
$      72$
$      73$
$      74$
$      75$
$      76$
$      77$
$      78$
$      79$
$      80$
$      81$
$      82$
$      83$
$      84$
$      85$
$      86$
$      87$
$      88$
$      89$
$      90$
$      91$
$      92$
$      93$
$      94$
$      95$
$      96$
$      97$
$      98$
$      99$
$     100$
$     101$
$     102$
$     103$
$     104$
$     105$
$     106$
$     107$
$     108$
$     109$
$     110$
$     111$
$     112$
$     113$
$     114$
$     115$
$     116$
$     117$
$     118$
$     119$
$     120$
$     121$
$     122$
$     123$
$     124$
$     125$
$     126$
$     127$
$     128$
...

#-----------------------------------------------------------------------------#
# BitsetIndex: BITS_ALL_SET (single bit)
#-----------------------------------------------------------------------------#

lua test(box.index.BITS_ALL_SET, 1)
---
sorted output
$       1$
$       3$
$       5$
$       7$
$       9$
$      11$
$      13$
$      15$
$      17$
$      19$
$      21$
$      23$
$      25$
$      27$
$      29$
$      31$
$      33$
$      35$
$      37$
$      39$
$      41$
$      43$
$      45$
$      47$
$      49$
$      51$
$      53$
$      55$
$      57$
$      59$
$      61$
$      63$
$      65$
$      67$
$      69$
$      71$
$      73$
$      75$
$      77$
$      79$
$      81$
$      83$
$      85$
$      87$
$      89$
$      91$
$      93$
$      95$
$      97$
$      99$
$     101$
$     103$
$     105$
$     107$
$     109$
$     111$
$     113$
$     115$
$     117$
$     119$
$     121$
$     123$
$     125$
$     127$
...
lua test(box.index.BITS_ALL_SET, 2)
---
sorted output
$       2$
$       3$
$       6$
$       7$
$      10$
$      11$
$      14$
$      15$
$      18$
$      19$
$      22$
$      23$
$      26$
$      27$
$      30$
$      31$
$      34$
$      35$
$      38$
$      39$
$      42$
$      43$
$      46$
$      47$
$      50$
$      51$
$      54$
$      55$
$      58$
$      59$
$      62$
$      63$
$      66$
$      67$
$      70$
$      71$
$      74$
$      75$
$      78$
$      79$
$      82$
$      83$
$      86$
$      87$
$      90$
$      91$
$      94$
$      95$
$      98$
$      99$
$     102$
$     103$
$     106$
$     107$
$     110$
$     111$
$     114$
$     115$
$     118$
$     119$
$     122$
$     123$
$     126$
$     127$
...
lua test(box.index.BITS_ALL_SET, 4)
---
sorted output
$       4$
$       5$
$       6$
$       7$
$      12$
$      13$
$      14$
$      15$
$      20$
$      21$
$      22$
$      23$
$      28$
$      29$
$      30$
$      31$
$      36$
$      37$
$      38$
$      39$
$      44$
$      45$
$      46$
$      47$
$      52$
$      53$
$      54$
$      55$
$      60$
$      61$
$      62$
$      63$
$      68$
$      69$
$      70$
$      71$
$      76$
$      77$
$      78$
$      79$
$      84$
$      85$
$      86$
$      87$
$      92$
$      93$
$      94$
$      95$
$     100$
$     101$
$     102$
$     103$
$     108$
$     109$
$     110$
$     111$
$     116$
$     117$
$     118$
$     119$
$     124$
$     125$
$     126$
$     127$
...
lua test(box.index.BITS_ALL_SET, 8)
---
sorted output
$       8$
$       9$
$      10$
$      11$
$      12$
$      13$
$      14$
$      15$
$      24$
$      25$
$      26$
$      27$
$      28$
$      29$
$      30$
$      31$
$      40$
$      41$
$      42$
$      43$
$      44$
$      45$
$      46$
$      47$
$      56$
$      57$
$      58$
$      59$
$      60$
$      61$
$      62$
$      63$
$      72$
$      73$
$      74$
$      75$
$      76$
$      77$
$      78$
$      79$
$      88$
$      89$
$      90$
$      91$
$      92$
$      93$
$      94$
$      95$
$     104$
$     105$
$     106$
$     107$
$     108$
$     109$
$     110$
$     111$
$     120$
$     121$
$     122$
$     123$
$     124$
$     125$
$     126$
$     127$
...
lua test(box.index.BITS_ALL_SET, 1073741824)
---
sorted output
...
lua test(box.index.BITS_ALL_SET, 2147483648)
---
sorted output
...
lua test(box.index.BITS_ALL_SET, 3)
---
sorted output
$       3$
$       7$
$      11$
$      15$
$      19$
$      23$
$      27$
$      31$
$      35$
$      39$
$      43$
$      47$
$      51$
$      55$
$      59$
$      63$
$      67$
$      71$
$      75$
$      79$
$      83$
$      87$
$      91$
$      95$
$      99$
$     103$
$     107$
$     111$
$     115$
$     119$
$     123$
$     127$
...
lua test(box.index.BITS_ALL_SET, 7)
---
sorted output
$       7$
$      15$
$      23$
$      31$
$      39$
$      47$
$      55$
$      63$
$      71$
$      79$
$      87$
$      95$
$     103$
$     111$
$     119$
$     127$
...
lua test(box.index.BITS_ALL_SET, 31)
---
sorted output
$      31$
$      63$
$      95$
$     127$
...
lua test(box.index.BITS_ALL_SET, 5)
---
sorted output
$       5$
$       7$
$      13$
$      15$
$      21$
$      23$
$      29$
$      31$
$      37$
$      39$
$      45$
$      47$
$      53$
$      55$
$      61$
$      63$
$      69$
$      71$
$      77$
$      79$
$      85$
$      87$
$      93$
$      95$
$     101$
$     103$
$     109$
$     111$
$     117$
$     119$
$     125$
$     127$
...
lua test(box.index.BITS_ALL_SET, 9)
---
sorted output
$       9$
$      11$
$      13$
$      15$
$      25$
$      27$
$      29$
$      31$
$      41$
$      43$
$      45$
$      47$
$      57$
$      59$
$      61$
$      63$
$      73$
$      75$
$      77$
$      79$
$      89$
$      91$
$      93$
$      95$
$     105$
$     107$
$     109$
$     111$
$     121$
$     123$
$     125$
$     127$
...
lua test(box.index.BITS_ALL_SET, 27)
---
sorted output
$      27$
$      31$
$      59$
$      63$
$      91$
$      95$
$     123$
$     127$
...
lua test(box.index.BITS_ALL_SET, 85)
---
sorted output
$      85$
$      87$
$      93$
$      95$
$     117$
$     119$
$     125$
$     127$
...
lua test(box.index.BITS_ALL_SET, 2147483648)
---
sorted output
...
lua test(box.index.BITS_ALL_SET, 2147483649)
---
sorted output
...
lua test(box.index.BITS_ALL_SET, 4294967295)
---
sorted output
...

#-----------------------------------------------------------------------------#
# BitsetIndex: BITS_ALL_NOTSET (single bit)
#-----------------------------------------------------------------------------#

lua test(box.index.BITS_ALL_NOTSET, 3)
---
sorted output
$       4$
$       8$
$      12$
$      16$
$      20$
$      24$
$      28$
$      32$
$      36$
$      40$
$      44$
$      48$
$      52$
$      56$
$      60$
$      64$
$      68$
$      72$
$      76$
$      80$
$      84$
$      88$
$      92$
$      96$
$     100$
$     104$
$     108$
$     112$
$     116$
$     120$
$     124$
$     128$
...
lua test(box.index.BITS_ALL_NOTSET, 27)
---
sorted output
$       4$
$      32$
$      36$
$      64$
$      68$
$      96$
$     100$
$     128$
...
lua test(box.index.BITS_ALL_NOTSET, 85)
---
sorted output
$       2$
$       8$
$      10$
$      32$
$      34$
$      40$
$      42$
$     128$
...
lua test(box.index.BITS_ALL_NOTSET, 4294967295)
---
sorted output
...

#-----------------------------------------------------------------------------#
# BitsetIndex: BITS_ANY_SET (single bit)
#-----------------------------------------------------------------------------#

lua test(box.index.BITS_ANY_SET, 0)
---
sorted output
...
lua test(box.index.BITS_ANY_SET, 84)
---
sorted output
$       4$
$       5$
$       6$
$       7$
$      12$
$      13$
$      14$
$      15$
$      16$
$      17$
$      18$
$      19$
$      20$
$      21$
$      22$
$      23$
$      24$
$      25$
$      26$
$      27$
$      28$
$      29$
$      30$
$      31$
$      36$
$      37$
$      38$
$      39$
$      44$
$      45$
$      46$
$      47$
$      48$
$      49$
$      50$
$      51$
$      52$
$      53$
$      54$
$      55$
$      56$
$      57$
$      58$
$      59$
$      60$
$      61$
$      62$
$      63$
$      64$
$      65$
$      66$
$      67$
$      68$
$      69$
$      70$
$      71$
$      72$
$      73$
$      74$
$      75$
$      76$
$      77$
$      78$
$      79$
$      80$
$      81$
$      82$
$      83$
$      84$
$      85$
$      86$
$      87$
$      88$
$      89$
$      90$
$      91$
$      92$
$      93$
$      94$
$      95$
$      96$
$      97$
$      98$
$      99$
$     100$
$     101$
$     102$
$     103$
$     104$
$     105$
$     106$
$     107$
$     108$
$     109$
$     110$
$     111$
$     112$
$     113$
$     114$
$     115$
$     116$
$     117$
$     118$
$     119$
$     120$
$     121$
$     122$
$     123$
$     124$
$     125$
$     126$
$     127$
...

#-----------------------------------------------------------------------------#
# BitsetIndex: BITS_ANY_NOTSET (single bit)
#-----------------------------------------------------------------------------#

lua test(box.index.BITS_ANY_NOTSET, 1)
---
sorted output
$       2$
$       4$
$       6$
$       8$
$      10$
$      12$
$      14$
$      16$
$      18$
$      20$
$      22$
$      24$
$      26$
$      28$
$      30$
$      32$
$      34$
$      36$
$      38$
$      40$
$      42$
$      44$
$      46$
$      48$
$      50$
$      52$
$      54$
$      56$
$      58$
$      60$
$      62$
$      64$
$      66$
$      68$
$      70$
$      72$
$      74$
$      76$
$      78$
$      80$
$      82$
$      84$
$      86$
$      88$
$      90$
$      92$
$      94$
$      96$
$      98$
$     100$
$     102$
$     104$
$     106$
$     108$
$     110$
$     112$
$     114$
$     116$
$     118$
$     120$
$     122$
$     124$
$     126$
$     128$
...
lua clear()
---
...
lua test(box.index.BITS_ALL)
---
sorted output
...
lua fill(113, 1024)
---
...

#-----------------------------------------------------------------------------#
# BitsetIndex: BITS_ALL_SET (multiple bit)
#-----------------------------------------------------------------------------#

lua test(box.index.BITS_ALL_SET, 3)
---
sorted output
$     339$
$     791$
$    1243$
$    1695$
$    2147$
$    2599$
$    3051$
$    3503$
$    3955$
$    4407$
$    4859$
$    5311$
$    5763$
$    6215$
$    6667$
$    7119$
$    7571$
$    8023$
$    8475$
$    8927$
$    9379$
$    9831$
$   10283$
$   10735$
$   11187$
$   11639$
$   12091$
$   12543$
$   12995$
$   13447$
$   13899$
$   14351$
$   14803$
$   15255$
$   15707$
$   16159$
$   16611$
$   17063$
$   17515$
$   17967$
$   18419$
$   18871$
$   19323$
$   19775$
$   20227$
$   20679$
$   21131$
$   21583$
$   22035$
$   22487$
$   22939$
$   23391$
$   23843$
$   24295$
$   24747$
$   25199$
$   25651$
$   26103$
$   26555$
$   27007$
$   27459$
$   27911$
$   28363$
$   28815$
$   29267$
$   29719$
$   30171$
$   30623$
$   31075$
$   31527$
$   31979$
$   32431$
$   32883$
$   33335$
$   33787$
$   34239$
$   34691$
$   35143$
$   35595$
$   36047$
$   36499$
$   36951$
$   37403$
$   37855$
$   38307$
$   38759$
$   39211$
$   39663$
$   40115$
$   40567$
$   41019$
$   41471$
$   41923$
$   42375$
$   42827$
$   43279$
$   43731$
$   44183$
$   44635$
$   45087$
$   45539$
$   45991$
$   46443$
$   46895$
$   47347$
$   47799$
$   48251$
$   48703$
$   49155$
$   49607$
$   50059$
$   50511$
$   50963$
$   51415$
$   51867$
$   52319$
$   52771$
$   53223$
$   53675$
$   54127$
$   54579$
$   55031$
$   55483$
$   55935$
$   56387$
$   56839$
$   57291$
$   57743$
$   58195$
$   58647$
$   59099$
$   59551$
$   60003$
$   60455$
$   60907$
$   61359$
$   61811$
$   62263$
$   62715$
$   63167$
$   63619$
$   64071$
$   64523$
$   64975$
$   65427$
$   65879$
$   66331$
$   66783$
$   67235$
$   67687$
$   68139$
$   68591$
$   69043$
$   69495$
$   69947$
$   70399$
$   70851$
$   71303$
$   71755$
$   72207$
$   72659$
$   73111$
$   73563$
$   74015$
$   74467$
$   74919$
$   75371$
$   75823$
$   76275$
$   76727$
$   77179$
$   77631$
$   78083$
$   78535$
$   78987$
$   79439$
$   79891$
$   80343$
$   80795$
$   81247$
$   81699$
$   82151$
$   82603$
$   83055$
$   83507$
$   83959$
$   84411$
$   84863$
$   85315$
$   85767$
$   86219$
$   86671$
$   87123$
$   87575$
$   88027$
$   88479$
$   88931$
$   89383$
$   89835$
$   90287$
$   90739$
$   91191$
$   91643$
$   92095$
$   92547$
$   92999$
$   93451$
$   93903$
$   94355$
$   94807$
$   95259$
$   95711$
$   96163$
$   96615$
$   97067$
$   97519$
$   97971$
$   98423$
$   98875$
$   99327$
$   99779$
$  100231$
$  100683$
$  101135$
$  101587$
$  102039$
$  102491$
$  102943$
$  103395$
$  103847$
$  104299$
$  104751$
$  105203$
$  105655$
$  106107$
$  106559$
$  107011$
$  107463$
$  107915$
$  108367$
$  108819$
$  109271$
$  109723$
$  110175$
$  110627$
$  111079$
$  111531$
$  111983$
$  112435$
$  112887$
$  113339$
$  113791$
$  114243$
$  114695$
$  115147$
$  115599$
...
lua test(box.index.BITS_ALL_SET, 7)
---
sorted output
$     791$
$    1695$
$    2599$
$    3503$
$    4407$
$    5311$
$    6215$
$    7119$
$    8023$
$    8927$
$    9831$
$   10735$
$   11639$
$   12543$
$   13447$
$   14351$
$   15255$
$   16159$
$   17063$
$   17967$
$   18871$
$   19775$
$   20679$
$   21583$
$   22487$
$   23391$
$   24295$
$   25199$
$   26103$
$   27007$
$   27911$
$   28815$
$   29719$
$   30623$
$   31527$
$   32431$
$   33335$
$   34239$
$   35143$
$   36047$
$   36951$
$   37855$
$   38759$
$   39663$
$   40567$
$   41471$
$   42375$
$   43279$
$   44183$
$   45087$
$   45991$
$   46895$
$   47799$
$   48703$
$   49607$
$   50511$
$   51415$
$   52319$
$   53223$
$   54127$
$   55031$
$   55935$
$   56839$
$   57743$
$   58647$
$   59551$
$   60455$
$   61359$
$   62263$
$   63167$
$   64071$
$   64975$
$   65879$
$   66783$
$   67687$
$   68591$
$   69495$
$   70399$
$   71303$
$   72207$
$   73111$
$   74015$
$   74919$
$   75823$
$   76727$
$   77631$
$   78535$
$   79439$
$   80343$
$   81247$
$   82151$
$   83055$
$   83959$
$   84863$
$   85767$
$   86671$
$   87575$
$   88479$
$   89383$
$   90287$
$   91191$
$   92095$
$   92999$
$   93903$
$   94807$
$   95711$
$   96615$
$   97519$
$   98423$
$   99327$
$  100231$
$  101135$
$  102039$
$  102943$
$  103847$
$  104751$
$  105655$
$  106559$
$  107463$
$  108367$
$  109271$
$  110175$
$  111079$
$  111983$
$  112887$
$  113791$
$  114695$
$  115599$
...
lua test(box.index.BITS_ALL_SET, 10)
---
sorted output
$    1130$
$    1243$
$    1582$
$    1695$
$    2938$
$    3051$
$    3390$
$    3503$
$    4746$
$    4859$
$    5198$
$    5311$
$    6554$
$    6667$
$    7006$
$    7119$
$    8362$
$    8475$
$    8814$
$    8927$
$   10170$
$   10283$
$   10622$
$   10735$
$   11978$
$   12091$
$   12430$
$   12543$
$   13786$
$   13899$
$   14238$
$   14351$
$   15594$
$   15707$
$   16046$
$   16159$
$   17402$
$   17515$
$   17854$
$   17967$
$   19210$
$   19323$
$   19662$
$   19775$
$   21018$
$   21131$
$   21470$
$   21583$
$   22826$
$   22939$
$   23278$
$   23391$
$   24634$
$   24747$
$   25086$
$   25199$
$   26442$
$   26555$
$   26894$
$   27007$
$   28250$
$   28363$
$   28702$
$   28815$
$   30058$
$   30171$
$   30510$
$   30623$
$   31866$
$   31979$
$   32318$
$   32431$
$   33674$
$   33787$
$   34126$
$   34239$
$   35482$
$   35595$
$   35934$
$   36047$
$   37290$
$   37403$
$   37742$
$   37855$
$   39098$
$   39211$
$   39550$
$   39663$
$   40906$
$   41019$
$   41358$
$   41471$
$   42714$
$   42827$
$   43166$
$   43279$
$   44522$
$   44635$
$   44974$
$   45087$
$   46330$
$   46443$
$   46782$
$   46895$
$   48138$
$   48251$
$   48590$
$   48703$
$   49946$
$   50059$
$   50398$
$   50511$
$   51754$
$   51867$
$   52206$
$   52319$
$   53562$
$   53675$
$   54014$
$   54127$
$   55370$
$   55483$
$   55822$
$   55935$
$   57178$
$   57291$
$   57630$
$   57743$
$   58986$
$   59099$
$   59438$
$   59551$
$   60794$
$   60907$
$   61246$
$   61359$
$   62602$
$   62715$
$   63054$
$   63167$
$   64410$
$   64523$
$   64862$
$   64975$
$   66218$
$   66331$
$   66670$
$   66783$
$   68026$
$   68139$
$   68478$
$   68591$
$   69834$
$   69947$
$   70286$
$   70399$
$   71642$
$   71755$
$   72094$
$   72207$
$   73450$
$   73563$
$   73902$
$   74015$
$   75258$
$   75371$
$   75710$
$   75823$
$   77066$
$   77179$
$   77518$
$   77631$
$   78874$
$   78987$
$   79326$
$   79439$
$   80682$
$   80795$
$   81134$
$   81247$
$   82490$
$   82603$
$   82942$
$   83055$
$   84298$
$   84411$
$   84750$
$   84863$
$   86106$
$   86219$
$   86558$
$   86671$
$   87914$
$   88027$
$   88366$
$   88479$
$   89722$
$   89835$
$   90174$
$   90287$
$   91530$
$   91643$
$   91982$
$   92095$
$   93338$
$   93451$
$   93790$
$   93903$
$   95146$
$   95259$
$   95598$
$   95711$
$   96954$
$   97067$
$   97406$
$   97519$
$   98762$
$   98875$
$   99214$
$   99327$
$  100570$
$  100683$
$  101022$
$  101135$
$  102378$
$  102491$
$  102830$
$  102943$
$  104186$
$  104299$
$  104638$
$  104751$
$  105994$
$  106107$
$  106446$
$  106559$
$  107802$
$  107915$
$  108254$
$  108367$
$  109610$
$  109723$
$  110062$
$  110175$
$  111418$
$  111531$
$  111870$
$  111983$
$  113226$
$  113339$
$  113678$
$  113791$
$  115034$
$  115147$
$  115486$
$  115599$
...
lua test(box.index.BITS_ALL_SET, 341)
---
sorted output
$    5085$
$    8023$
$    8701$
$   11639$
$   22487$
$   23391$
$   26103$
$   27007$
$   33109$
$   36725$
$   37855$
$   41471$
$   47573$
$   48477$
$   51189$
$   52093$
$   62941$
$   65879$
$   66557$
$   69495$
$   80343$
$   81247$
$   83959$
$   84863$
$   90965$
$   94581$
$   95711$
$   99327$
$  105429$
$  106333$
$  109045$
$  109949$
...

#-----------------------------------------------------------------------------#
# BitsetIndex: remove all
#-----------------------------------------------------------------------------#

lua clear()
---
...
lua test(box.index.BITS_ALL)
---
sorted output
...
lua fill(1, 16)
---
...

#-----------------------------------------------------------------------------#
# BitsetIndex: BITS_ANY_SET (multiple bit)
#-----------------------------------------------------------------------------#

lua test(box.index.BITS_ANY_SET, 7)
---
sorted output
$       1$
$       2$
$       3$
$       4$
$       5$
$       6$
$       7$
$       9$
$      10$
$      11$
$      12$
$      13$
$      14$
$      15$
...
lua test(box.index.BITS_ANY_SET, 10)
---
sorted output
$       2$
$       3$
$       6$
$       7$
$       8$
$       9$
$      10$
$      11$
$      12$
$      13$
$      14$
$      15$
...

#-----------------------------------------------------------------------------#
# BitsetIndex: BITS_ALL_NOTSET (multiple bit)
#-----------------------------------------------------------------------------#

lua test(box.index.BITS_ALL_NOTSET, 7)
---
sorted output
$       8$
$      16$
...
lua test(box.index.BITS_ALL_NOTSET, 10)
---
sorted output
$       1$
$       4$
$       5$
$      16$
...

#-----------------------------------------------------------------------------#
# BitsetIndex: stress test
#-----------------------------------------------------------------------------#

lua n = 1024
---
...
lua t = {2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53}
---
...
lua clear()
---
...
lua fill(1, n)
---
...
lua for _, v in ipairs(t) do remove(v, n / v) end
---
...
lua test(box.index.BITS_ALL_SET, 63)
---
sorted output
$     127$
$     191$
$     383$
...
lua clear()
---
...
lua test(box.index.BITS_ALL)
---
sorted output
...
